<div id="stock-view" class="view">
    <!-- 上部：搜索区 -->
    <div class="card stock-header-panel">
        <div class="stock-controls">
            <!-- 1. SKU 搜索输入 -->
            <div class="floating-label-group main-input">
                <input type="text" id="stock-search-input" placeholder=" " autocomplete="off" style="padding-right: 40px;">
                <label>搜索 SKU / 条码 / 产品名称</label>
                <button class="btn-icon-only scan-btn" title="开启摄像头">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                </button>
            </div>

            <!-- 2. 仓库选择 -->
            <div class="floating-label-group">
                <select id="stock-warehouse" name="warehouse" autocomplete="off">
                    <option value="">全部仓库</option>
                    <option value="__new__">+ 新建...</option>
                </select>
                <label>仓库</label>
            </div>

            <!-- 3. 搜索按钮 -->
            <div class="control-group" style="flex: 0 0 auto;">
                <button class="btn btn-black btn-lg-height" onclick="searchStock()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    搜索
                </button>
            </div>
        </div>
    </div>

    <!-- 下部：库存列表 -->
    <div class="card stock-list-panel">
        <div class="panel-header">
            <div class="panel-title">库存列表</div>
            <div class="panel-info text-secondary">共 <strong>128</strong> 个 SKU</div>
        </div>
        <div class="table-container">
            <table class="data-table stock-table">
                <thead>
                    <tr>
                        <th style="width: 60px">序号</th>
                        <th style="width: 100px">产品图片</th>
                        <th>产品信息</th>
                        <th style="width: 100px">库存数量</th>
                        <th style="width: 100px">安全库存</th>
                        <th style="width: 100px">状态</th>
                        <th style="width: 100px" class="text-center">操作</th>
                    </tr>
                </thead>
                <tbody id="stock-list-body">
                    <!-- 示例行 1 - 正常库存 -->
                    <tr class="sku-row" onclick="showSKUDetails('SKU-123456')">
                        <td>1</td>
                        <td>
                            <div class="img-thumbnail-small" onclick="event.stopPropagation(); showLightbox('https://via.placeholder.com/1500');">
                                <img src="https://via.placeholder.com/100" alt="Product">
                            </div>
                        </td>
                        <td>
                            <div class="sku-info">
                                <div class="sku-code">SKU-123456</div>
                                <div class="sku-name text-secondary">示例产品名称 - 黑色 XL</div>
                                <div class="sku-meta text-secondary">主仓库</div>
                            </div>
                        </td>
                        <td>
                            <div class="stock-qty stock-normal">150</div>
                        </td>
                        <td>
                            <div class="safe-stock">50</div>
                        </td>
                        <td>
                            <span class="badge badge-success">正常</span>
                        </td>
                        <td class="text-center">
                            <button class="btn-icon-action" title="调整库存" onclick="openAdjustModal('SKU-123456')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            </button>
                        </td>
                    </tr>

                    <!-- 示例行 2 - 低库存 -->
                    <tr>
                        <td>2</td>
                        <td>
                            <div class="img-thumbnail-small" onclick="showLightbox('https://via.placeholder.com/1500')">
                                <img src="https://via.placeholder.com/100" alt="Product">
                            </div>
                        </td>
                        <td>
                            <div class="sku-info">
                                <div class="sku-code">SKU-789012</div>
                                <div class="sku-name text-secondary">示例产品 B - 白色 M</div>
                                <div class="sku-meta text-secondary">主仓库</div>
                            </div>
                        </td>
                        <td>
                            <div class="stock-qty stock-low">15</div>
                        </td>
                        <td>
                            <div class="safe-stock">50</div>
                        </td>
                        <td>
                            <span class="badge badge-warning">低库存</span>
                        </td>
                        <td class="text-center">
                            <button class="btn-icon-action" title="调整库存" onclick="openAdjustModal('SKU-789012')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            </button>
                        </td>
                    </tr>

                    <!-- 示例行 3 - 缺货 -->
                    <tr>
                        <td>3</td>
                        <td>
                            <div class="img-thumbnail-small" onclick="showLightbox('https://via.placeholder.com/1500')">
                                <img src="https://via.placeholder.com/100" alt="Product">
                            </div>
                        </td>
                        <td>
                            <div class="sku-info">
                                <div class="sku-code">SKU-345678</div>
                                <div class="sku-name text-secondary">示例产品 C - 红色 L</div>
                                <div class="sku-meta text-secondary">售后仓库</div>
                            </div>
                        </td>
                        <td>
                            <div class="stock-qty stock-out">0</div>
                        </td>
                        <td>
                            <div class="safe-stock">20</div>
                        </td>
                        <td>
                            <span class="badge badge-error">缺货</span>
                        </td>
                        <td class="text-center">
                            <button class="btn-icon-action" title="调整库存" onclick="openAdjustModal('SKU-345678')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 库存调整模态框 -->
<div id="adjust-stock-modal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3>调整库存</h3>
            <button class="btn-close" onclick="closeModal('adjust-stock-modal')">
                <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="adjust-info">
                <div class="info-row">
                    <span class="info-label">SKU:</span>
                    <span class="info-value" id="adjust-sku-code">SKU-123456</span>
                </div>
                <div class="info-row">
                    <span class="info-label">产品名称:</span>
                    <span class="info-value" id="adjust-sku-name">示例产品名称 - 黑色 XL</span>
                </div>
                <div class="info-row">
                    <span class="info-label">当前库存:</span>
                    <span class="info-value" id="adjust-current-stock">150</span>
                </div>
            </div>

            <div class="floating-label-group">
                <select id="adjust-type" autocomplete="off">
                    <option value="add">增加库存 (+)</option>
                    <option value="reduce">减少库存 (-)</option>
                    <option value="set">设置库存 (=)</option>
                    <option value="__new__">+ 新建...</option>
                </select>
                <label>调整类型</label>
            </div>

            <div class="floating-label-group">
                <input type="number" id="adjust-qty" min="0" value="0" placeholder=" " autocomplete="off">
                <label>调整数量</label>
            </div>

            <div class="floating-label-group">
                <textarea id="adjust-note" rows="3" placeholder=" "></textarea>
                <label>备注</label>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('adjust-stock-modal')">取消</button>
            <button class="btn btn-black">确认调整</button>
        </div>
    </div>
</div>

<!-- 灯箱 -->
<div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
    <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="Large View">
        <button class="lightbox-close">&times;</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadSelectOptions('warehouse', 'warehouse');
    });

    function searchStock() {
        const query = document.getElementById('stock-search-input').value;
        const warehouse = document.getElementById('stock-warehouse').value;
        alert('搜索: ' + query + ' | 仓库: ' + (warehouse || '全部'));
    }

    function openAdjustModal(sku) {
        openModal('adjust-stock-modal');
        document.getElementById('adjust-sku-code').textContent = sku;
    }

    function showLightbox(src) {
        const lightbox = document.getElementById('lightbox');
        const img = document.getElementById('lightbox-img');
        img.src = src;
        lightbox.classList.add('active');
    }

    function closeLightbox() {
        document.getElementById('lightbox').classList.remove('active');
    }
</script>

<style>
    .stock-header-panel {
        padding: 24px;
        margin-bottom: 24px;
    }

    .stock-controls {
        display: flex;
        gap: 16px;
        align-items: flex-end;
        width: 100%;
    }

    .control-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex: 1;
        min-width: 120px;
    }

    .control-group.main-input {
        flex: 3;
        min-width: 300px;
    }

    .control-group label {
        display: block;
        font-size: 12px;
        font-weight: 500;
        color: #4b5563;
        margin-bottom: 0;
    }

    .input-wrapper-large {
        position: relative;
    }

    .input-wrapper-large input {
        width: 100%;
        padding: 0 12px 0 16px;
        padding-right: 40px;
        font-size: 13px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        height: 36px;
        outline: none;
        line-height: 36px;
    }

    .input-wrapper-large input:focus {
        border-color: #1a1a1a;
    }

    .scan-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        background: none;
        border: none;
        cursor: pointer;
    }

    .form-control {
        height: 36px;
        font-size: 13px;
        border-radius: 4px;
        padding: 0 12px;
    }

    .btn {
        height: 36px;
        font-size: 13px;
        padding: 0 16px;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .stock-list-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .panel-header {
        padding: 16px 24px;
        border-bottom: 1px solid #f3f4f6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .panel-title {
        font-size: 16px;
        font-weight: 600;
    }

    .panel-info {
        font-size: 13px;
    }

    .img-thumbnail-small {
        width: 60px;
        height: 60px;
        background: #f9fafb;
        border-radius: 4px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
        cursor: zoom-in;
    }

    .img-thumbnail-small img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .sku-code {
        font-weight: 600;
        color: #1a1a1a;
        font-size: 13px;
    }

    .sku-name {
        font-size: 12px;
        margin-top: 2px;
    }

    .sku-meta {
        font-size: 11px;
        margin-top: 2px;
    }

    .stock-qty {
        font-weight: 600;
        font-size: 15px;
        text-align: center;
    }

    .stock-normal {
        color: #059669;
    }

    .stock-low {
        color: #f59e0b;
    }

    .stock-out {
        color: #ef4444;
    }

    .safe-stock {
        font-size: 13px;
        color: #6b7280;
        text-align: center;
    }

    .badge {
        display: inline-block;
        padding: 4px 12px;
        font-size: 11px;
        font-weight: 600;
        border-radius: 12px;
        text-transform: uppercase;
    }

    .badge-success {
        background: #d1fae5;
        color: #065f46;
    }

    .badge-warning {
        background: #fef3c7;
        color: #92400e;
    }

    .badge-error {
        background: #fee2e2;
        color: #991b1b;
    }

    .btn-icon-action {
        background: white;
        border: 1px solid #d1d5db;
        cursor: pointer;
        padding: 6px;
        color: #374151;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .btn-icon-action:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
        color: #1a1a1a;
    }

    .btn-icon-action svg {
        width: 18px;
        height: 18px;
        stroke-width: 2;
    }

    .adjust-info {
        background: #f9fafb;
        padding: 16px;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        font-size: 13px;
    }

    .info-label {
        color: #6b7280;
        font-weight: 500;
    }

    .info-value {
        color: #1a1a1a;
        font-weight: 600;
    }

    .lightbox-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        cursor: zoom-out;
    }

    .lightbox-overlay.active {
        display: flex;
        animation: fadeIn 0.2s;
    }

    .lightbox-content {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
    }

    .lightbox-content img {
        max-width: 100%;
        max-height: 90vh;
        border-radius: 4px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .lightbox-close {
        position: absolute;
        top: -40px;
        right: 0;
        background: none;
        border: none;
        color: white;
        font-size: 32px;
        cursor: pointer;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* 修复模态框内浮动标签的间距 */
    .modal-body .floating-label-group {
        margin-bottom: 16px;
    }
</style>
