<div id="expenses-view" class="view">
    <!-- 上部：快速录入 -->
    <div class="card expenses-entry-panel">
        <div class="panel-header">
            <div class="panel-title">快速录入费用</div>
        </div>
        <div class="entry-form">
            <div class="form-row">
                <div class="floating-label-group">
                    <input type="date" id="new-expense-date" autocomplete="off" placeholder=" ">
                    <label>日期</label>
                </div>
                <div class="floating-label-group">
                    <select id="new-expense-type" autocomplete="off">
                        <option value="">请选择...</option>
                        <option value="shipping">物流费用</option>
                        <option value="packaging">包装费用</option>
                        <option value="platform">平台费用</option>
                        <option value="marketing">营销费用</option>
                        <option value="other">其他费用</option>
                        <option value="__new__">+ 新建...</option>
                    </select>
                    <label>费用类型</label>
                </div>
                <div class="floating-label-group">
                    <input type="number" id="new-expense-amount" min="0" step="0.01" placeholder=" " autocomplete="off">
                    <label>金额 (THB)</label>
                </div>
                <div class="floating-label-group flex-2">
                    <input type="text" id="new-expense-note" placeholder=" " autocomplete="off">
                    <label>备注</label>
                </div>
                <div class="control-group" style="flex: 1;">
                    <div class="image-upload-wrapper">
                        <input type="file" id="expense-image-input" accept="image/*" hidden>
                        <button class="btn btn-outline btn-block btn-lg-height" onclick="document.getElementById('expense-image-input').click()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            选择图片
                        </button>
                    </div>
                </div>
                <div class="control-group" style="flex: 0 0 auto;">
                    <button class="btn btn-black btn-block btn-lg-height" onclick="addExpense()">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        添加
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 中部：筛选区 -->
    <div class="card expenses-filter-panel">
        <div class="filter-title">费用筛选</div>
        <div class="expenses-filters">
            <!-- 第一行 -->
            <div class="filter-row">
                <!-- 1. 日期选择 (拆分为两个浮动标签) -->
                <div class="floating-label-group">
                    <input type="date" id="date-from" placeholder=" ">
                    <label>开始日期</label>
                </div>
                <div class="floating-label-group">
                    <input type="date" id="date-to" placeholder=" ">
                    <label>结束日期</label>
                </div>

                <!-- 快捷日期选择 -->
                <div class="control-group" style="flex: 2;">
                    <div class="quick-date-buttons">
                        <button class="btn-quick-date" onclick="selectQuickDate('today')">今天</button>
                        <button class="btn-quick-date" onclick="selectQuickDate('thisWeek')">本周</button>
                        <button class="btn-quick-date" onclick="selectQuickDate('thisMonth')">本月</button>
                        <button class="btn-quick-date" onclick="selectQuickDate('lastMonth')">上月</button>
                    </div>
                </div>
            </div>

            <!-- 第二行 -->
            <div class="filter-row">
                <!-- 2. 费用类型 -->
                <div class="floating-label-group">
                    <select id="expense-type-filter" autocomplete="off">
                        <option value="">全部类型</option>
                        <option value="shipping">物流费用</option>
                        <option value="packaging">包装费用</option>
                        <option value="platform">平台费用</option>
                        <option value="marketing">营销费用</option>
                        <option value="other">其他费用</option>
                        <option value="__new__">+ 新建...</option>
                    </select>
                    <label>费用类型</label>
                </div>

                <!-- 3. 金额筛选 (拆分为两个浮动标签) -->
                <div class="floating-label-group">
                    <input type="number" id="amount-min" min="0" step="0.01" placeholder=" " autocomplete="off">
                    <label>最小金额</label>
                </div>
                <div class="floating-label-group">
                    <input type="number" id="amount-max" min="0" step="0.01" placeholder=" " autocomplete="off">
                    <label>最大金额</label>
                </div>

                <!-- 操作按钮 -->
                <div class="control-group filter-actions" style="flex: 0 0 auto;">
                    <div class="action-buttons">
                        <button class="btn btn-black btn-lg-height" onclick="applyFilters()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
                            筛选
                        </button>
                        <button class="btn btn-outline btn-lg-height" onclick="resetFilters()">重置</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 下部：费用明细列表 -->
    <div class="card expenses-list-panel">
        <div class="panel-header">
            <div class="panel-title">费用明细</div>
            <div class="panel-info text-secondary">
                共 <strong>45</strong> 条记录 | 总计: <strong class="text-error">฿ 12,580.50</strong>
            </div>
        </div>
        <div class="table-container">
            <table class="data-table expenses-table">
                <thead>
                    <tr>
                        <th style="width: 60px">序号</th>
                        <th style="width: 120px">日期</th>
                        <th style="width: 150px">费用类型</th>
                        <th style="width: 120px" class="text-right">金额 (THB)</th>
                        <th>备注</th>
                        <th style="width: 80px">凭证</th>
                        <th style="width: 100px" class="text-center">操作</th>
                    </tr>
                </thead>
                <tbody id="expenses-list-body">
                    <!-- 示例行 1 -->
                    <tr>
                        <td>1</td>
                        <td>2025-11-19</td>
                        <td>
                            <span class="expense-type-badge type-shipping">物流费用</span>
                        </td>
                        <td class="text-right font-num">฿ 450.00</td>
                        <td class="text-secondary">快递费 - 订单 #12345</td>
                        <td class="text-center">
                            <button class="btn-view-image" onclick="showLightbox('https://via.placeholder.com/1500')" title="查看凭证">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            </button>
                        </td>
                        <td class="text-center">
                            <div class="action-icons">
                                <button class="btn-icon-action" title="编辑">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </button>
                                <button class="btn-icon-action text-error" title="删除">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                </button>
                            </div>
                        </td>
                    </tr>

                    <!-- 示例行 2 -->
                    <tr>
                        <td>2</td>
                        <td>2025-11-18</td>
                        <td>
                            <span class="expense-type-badge type-platform">平台费用</span>
                        </td>
                        <td class="text-right font-num">฿ 1,250.00</td>
                        <td class="text-secondary">Shopee 佣金 - 11月</td>
                        <td class="text-center">
                            <span class="text-secondary">-</span>
                        </td>
                        <td class="text-center">
                            <div class="action-icons">
                                <button class="btn-icon-action" title="编辑">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </button>
                                <button class="btn-icon-action text-error" title="删除">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 灯箱 -->
<div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
    <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="Large View">
        <button class="lightbox-close">&times;</button>
    </div>
</div>

<script>
    // 设置今天的日期为默认值
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('new-expense-date').value = today;
    });

    function selectQuickDate(period) {
        const today = new Date();
        const dateFrom = document.getElementById('date-from');
        const dateTo = document.getElementById('date-to');
        
        switch(period) {
            case 'today':
                dateFrom.value = today.toISOString().split('T')[0];
                dateTo.value = today.toISOString().split('T')[0];
                break;
            case 'thisWeek':
                const weekStart = new Date(today.setDate(today.getDate() - today.getDay()));
                dateFrom.value = weekStart.toISOString().split('T')[0];
                dateTo.value = new Date().toISOString().split('T')[0];
                break;
            case 'thisMonth':
                const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                dateFrom.value = monthStart.toISOString().split('T')[0];
                dateTo.value = new Date().toISOString().split('T')[0];
                break;
            case 'lastMonth':
                const lastMonthStart = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
                dateFrom.value = lastMonthStart.toISOString().split('T')[0];
                dateTo.value = lastMonthEnd.toISOString().split('T')[0];
                break;
        }
    }

    function applyFilters() {
        const dateFrom = document.getElementById('date-from').value;
        const dateTo = document.getElementById('date-to').value;
        const type = document.getElementById('expense-type-filter').value;
        const amountMin = document.getElementById('amount-min').value;
        const amountMax = document.getElementById('amount-max').value;
        
        alert('筛选条件:\n日期: ' + dateFrom + ' 至 ' + dateTo + '\n类型: ' + (type || '全部') + '\n金额: ' + (amountMin || '0') + ' - ' + (amountMax || '∞'));
    }

    function resetFilters() {
        document.getElementById('date-from').value = '';
        document.getElementById('date-to').value = '';
        document.getElementById('expense-type-filter').value = '';
        document.getElementById('amount-min').value = '';
        document.getElementById('amount-max').value = '';
    }

    function addExpense() {
        const date = document.getElementById('new-expense-date').value;
        const type = document.getElementById('new-expense-type').value;
        const amount = document.getElementById('new-expense-amount').value;
        const note = document.getElementById('new-expense-note').value;
        
        if (!date || !type || !amount) {
            alert('请填写必填项：日期、类型、金额');
            return;
        }
        
        alert('添加费用:\n日期: ' + date + '\n类型: ' + type + '\n金额: ฿ ' + amount + '\n备注: ' + note);
    }

    function showLightbox(src) {
        const lightbox = document.getElementById('lightbox');
        const img = document.getElementById('lightbox-img');
        img.src = src;
        lightbox.classList.add('active');
    }

    function closeLightbox() {
        document.getElementById('lightbox').classList.remove('active');
    }
</script>

<style>
    .expenses-entry-panel {
        padding: 24px;
        margin-bottom: 24px;
    }

    .expenses-filter-panel {
        padding: 24px;
        margin-bottom: 24px;
    }

    .filter-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 16px;
        color: #1a1a1a;
    }

    .expenses-filters {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .filter-row {
        display: flex;
        gap: 16px;
        align-items: flex-end;
    }

    .control-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex: 1;
    }

    .control-group.date-range-group {
        flex: 2;
    }

    .control-group label {
        display: block;
        font-size: 12px;
        font-weight: 500;
        color: #4b5563;
    }

    .form-control {
        height: 36px;
        font-size: 13px;
        border-radius: 4px;
        padding: 0 12px;
        border: 1px solid #d1d5db;
        outline: none;
    }

    .form-control:focus {
        border-color: #1a1a1a;
    }

    .date-selector, .amount-selector {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .date-separator, .amount-separator {
        color: #9ca3af;
        font-size: 12px;
    }

    .quick-date-buttons {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }

    .btn-quick-date {
        padding: 6px 12px;
        font-size: 11px;
        border: 1px solid #d1d5db;
        background: white;
        border-radius: 4px;
        cursor: pointer;
        color: #4b5563;
        transition: all 0.2s;
    }

    .btn-quick-date:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
    }

    .btn {
        height: 36px;
        font-size: 13px;
        padding: 0 16px;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }

    .entry-form {
        margin-top: 16px;
    }

    .form-row {
        display: flex;
        gap: 12px;
        align-items: flex-end;
    }

    .form-group {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .form-group.flex-2 {
        flex: 2;
    }

    .image-upload-wrapper {
        position: relative;
    }

    .btn-upload {
        width: 100%;
        justify-content: center;
    }

    .expenses-list-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .panel-header {
        padding: 16px 24px;
        border-bottom: 1px solid #f3f4f6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .panel-title {
        font-size: 16px;
        font-weight: 600;
    }

    .panel-info {
        font-size: 13px;
    }

    .expense-type-badge {
        display: inline-block;
        padding: 4px 10px;
        font-size: 11px;
        font-weight: 600;
        border-radius: 4px;
    }

    .type-shipping {
        background: #dbeafe;
        color: #1e40af;
    }

    .type-packaging {
        background: #fef3c7;
        color: #92400e;
    }

    .type-platform {
        background: #e0e7ff;
        color: #3730a3;
    }

    .type-marketing {
        background: #fce7f3;
        color: #9f1239;
    }

    .type-other {
        background: #f3f4f6;
        color: #374151;
    }

    .btn-view-image {
        background: white;
        border: 1px solid #d1d5db;
        cursor: pointer;
        padding: 4px;
        color: #6b7280;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .btn-view-image:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
        color: #1a1a1a;
    }

    .btn-view-image svg {
        width: 16px;
        height: 16px;
    }

    .action-icons {
        display: flex;
        justify-content: center;
        gap: 8px;
    }

    .btn-icon-action {
        background: white;
        border: 1px solid #d1d5db;
        cursor: pointer;
        padding: 6px;
        color: #374151;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .btn-icon-action:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
        color: #1a1a1a;
    }

    .btn-icon-action svg {
        width: 18px;
        height: 18px;
        stroke-width: 2;
    }

    .text-error {
        color: #ef4444;
    }

    .lightbox-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        cursor: zoom-out;
    }

    .lightbox-overlay.active {
        display: flex;
        animation: fadeIn 0.2s;
    }

    .lightbox-content {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
    }

    .lightbox-content img {
        max-width: 100%;
        max-height: 90vh;
        border-radius: 4px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .lightbox-close {
        position: absolute;
        top: -40px;
        right: 0;
        background: none;
        border: none;
        color: white;
        font-size: 32px;
        cursor: pointer;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
