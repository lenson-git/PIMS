<div id="outbound-view" class="view">
    <!-- ‰∏äÈÉ®ÔºöÊìç‰ΩúÂå∫ -->
    <div class="card outbound-header-panel">
        <div class="outbound-controls">
            <!-- 1. SKU Êâ´Á†ÅËæìÂÖ• -->
            <div class="floating-label-group main-input">
                <input type="text" id="outbound-sku-input" placeholder=" " autocomplete="off" style="padding-right: 40px;">
                <label>Êâ´Êèè/ËæìÂÖ• SKU</label>
                <button class="btn-icon-only scan-btn" title="ÂºÄÂêØÊëÑÂÉèÂ§¥">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                </button>
            </div>

            <!-- 2. ‰ªìÂ∫ìÈÄâÊã© -->
            <div class="floating-label-group">
                <select id="outbound-warehouse" name="warehouse" autocomplete="off">
                    <option value=""></option>
                    <option value="__new__">+ Êñ∞Âª∫...</option>
                </select>
                <label>Âá∫Â∫ì‰ªìÂ∫ì</label>
            </div>

            <!-- 3. Âá∫Â∫ìÁ±ªÂûã -->
            <div class="floating-label-group">
                <select id="outbound-type" name="outbound_type" autocomplete="off">
                    <option value=""></option>
                    <option value="__new__">+ Êñ∞Âª∫...</option>
                </select>
                <label>Âá∫Â∫ìÁ±ªÂûã</label>
            </div>

            <!-- 4. ËÆ¢ÂçïÂØºÂÖ• -->
            <div class="control-group" style="flex: 0 0 auto;">
                <button class="btn btn-outline btn-lg-height" onclick="triggerOrderUpload()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                    ÂØºÂÖ•ËÆ¢Âçï
                </button>
                <input type="file" id="order-upload-input" accept=".xlsx,.xls,.csv" hidden>
            </div>
        </div>
    </div>

    <!-- ‰∏ãÈÉ®ÔºöÂæÖÂá∫Â∫ìÊ∏ÖÂçï -->
    <div class="card outbound-list-panel">
        <div class="panel-header">
            <div class="panel-title">ÂæÖÂá∫Â∫ìÊ∏ÖÂçï</div>
            <div class="panel-actions">
                <button class="btn btn-black" onclick="submitOutbound()">Á°ÆËÆ§Âá∫Â∫ì</button>
            </div>
        </div>
        <div class="table-container">
            <table class="data-table outbound-table">
                <thead>
                    <tr>
                        <th style="width: 60px">Â∫èÂè∑</th>
                        <th style="width: 100px">ÂõæÁâá</th>
                        <th>SKU ‰ø°ÊÅØ</th>
                        <th style="width: 100px">ÂΩìÂâçÂ∫ìÂ≠ò</th>
                        <th style="width: 120px">Âá∫Â∫ìÊï∞Èáè</th>
                        <th style="width: 80px" class="text-center">Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody id="outbound-list-body">
                    <!-- Á§∫‰æãË°å 1 - Â∫ìÂ≠òÂÖÖË∂≥ -->
                    <tr class="sku-row outbound-row" id="row-sku-123" onclick="showSKUDetails('SKU-123456')">
                        <td>1</td>
                        <td>
                            <div class="img-thumbnail-small" onclick="event.stopPropagation(); showLightbox('https://via.placeholder.com/1500');">
                                <img src="https://via.placeholder.com/100" alt="Product">
                            </div>
                        </td>
                        <td>
                            <div class="sku-info">
                                <div class="sku-code">SKU-123456</div>
                                <div class="sku-name text-secondary">Á§∫‰æã‰∫ßÂìÅÂêçÁß∞ - ÈªëËâ≤ XL</div>
                            </div>
                        </td>
                        <td>
                            <div class="stock-qty stock-normal">150</div>
                        </td>
                        <td>
                            <div class="qty-input-group">
                                <button class="btn-qty-minus">-</button>
                                <input type="number" class="form-control-qty" value="1" max="150" autocomplete="off">
                                <button class="btn-qty-plus">+</button>
                            </div>
                        </td>
                        <td class="text-center">
                            <button class="btn-icon-action text-error" title="Âà†Èô§">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </td>
                    </tr>

                    <!-- Á§∫‰æãË°å 2 - Â∫ìÂ≠ò‰∏çË∂≥ -->
                    <tr class="outbound-row row-warning" id="row-sku-456">
                        <td>2</td>
                        <td>
                            <div class="img-thumbnail-small" onclick="showLightbox('https://via.placeholder.com/1500')">
                                <img src="https://via.placeholder.com/100" alt="Product">
                            </div>
                        </td>
                        <td>
                            <div class="sku-info">
                                <div class="sku-code">SKU-456789</div>
                                <div class="sku-name text-secondary">Á§∫‰æã‰∫ßÂìÅ B - ÁôΩËâ≤ M</div>
                            </div>
                        </td>
                        <td>
                            <div class="stock-qty stock-low">5</div>
                        </td>
                        <td>
                            <div class="qty-input-group">
                                <button class="btn-qty-minus">-</button>
                                <input type="number" class="form-control-qty" value="3" max="5">
                                <button class="btn-qty-plus">+</button>
                            </div>
                        </td>
                        <td class="text-center">
                            <button class="btn-icon-action text-error" title="Âà†Èô§">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <!-- Á©∫Áä∂ÊÄÅÊèêÁ§∫ -->
            <div id="outbound-empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon">üì§</div>
                <div class="empty-text">ÊöÇÊó†Âá∫Â∫ìÂïÜÂìÅÔºåËØ∑Êâ´ÊèèÊù°Á†ÅÊàñÂØºÂÖ•ËÆ¢Âçï</div>
            </div>
        </div>
    </div>
</div>

<!-- Â∫ìÂ≠ò‰∏çË∂≥Ë≠¶ÂëäÊ®°ÊÄÅÊ°Ü -->
<div id="stock-warning-modal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3>‚ö†Ô∏è Â∫ìÂ≠ò‰∏çË∂≥Ë≠¶Âëä</h3>
            <button class="btn-close" onclick="closeModal('stock-warning-modal')">
                <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="alert alert-warning">
                ‰ª•‰∏ãÂïÜÂìÅÂ∫ìÂ≠ò‰∏çË∂≥ÔºåÊó†Ê≥ïÂÆåÊàêÂá∫Â∫ìÊìç‰ΩúÔºö
            </div>
            <ul id="warning-list" class="warning-list">
                <li>SKU-456789: ÂΩìÂâçÂ∫ìÂ≠ò 5ÔºåÈúÄË¶ÅÂá∫Â∫ì 10</li>
            </ul>
        </div>
        <div class="modal-footer">
            <button class="btn btn-black" onclick="closeModal('stock-warning-modal')">Áü•ÈÅì‰∫Ü</button>
        </div>
    </div>
</div>

<!-- ÁÅØÁÆ± -->
<div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
    <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="Large View">
        <button class="lightbox-close">&times;</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadSelectOptions('warehouse', 'warehouse');
        loadSelectOptions('outbound_type', 'outbound_type');
    });

    function submitOutbound() {
        // Ê£ÄÊü•Â∫ìÂ≠òÊòØÂê¶ÂÖÖË∂≥
        const rows = document.querySelectorAll('.outbound-row');
        let hasWarning = false;
        
        rows.forEach(row => {
            const stockQty = parseInt(row.querySelector('.stock-qty').textContent);
            const outboundQty = parseInt(row.querySelector('.form-control-qty').value);
            
            if (outboundQty > stockQty) {
                hasWarning = true;
                row.classList.add('row-warning');
            } else {
                row.classList.remove('row-warning');
            }
        });
        
        if (hasWarning) {
            openModal('stock-warning-modal');
        } else {
            alert('Âá∫Â∫ìÊàêÂäüÔºÅ');
        }
    }

    function showLightbox(src) {
        const lightbox = document.getElementById('lightbox');
        const img = document.getElementById('lightbox-img');
        img.src = src;
        lightbox.classList.add('active');
    }

    function closeLightbox() {
        document.getElementById('lightbox').classList.remove('active');
    }

    function triggerOrderUpload() {
        document.getElementById('order-upload-input').click();
    }
</script>

<style>
    .outbound-header-panel {
        padding: 24px;
        margin-bottom: 24px;
    }

    .outbound-controls {
        display: flex;
        gap: 16px;
        align-items: flex-end;
        width: 100%;
    }

    .control-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex: 1;
        min-width: 120px;
    }

    .control-group.main-input {
        flex: 3;
        min-width: 300px;
    }

    .control-group label {
        display: block;
        font-size: 12px;
        font-weight: 500;
        color: #4b5563;
        margin-bottom: 0;
    }

    .input-wrapper-large {
        position: relative;
    }

    .input-wrapper-large input {
        width: 100%;
        padding: 0 12px 0 16px;
        padding-right: 40px;
        font-size: 13px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        height: 36px;
        outline: none;
        line-height: 36px;
    }

    .input-wrapper-large input:focus {
        border-color: #1a1a1a;
    }

    .scan-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        background: none;
        border: none;
        cursor: pointer;
    }

    .form-control {
        height: 36px;
        font-size: 13px;
        border-radius: 4px;
        padding: 0 12px;
    }

    .btn {
        height: 36px;
        font-size: 13px;
        padding: 0 16px;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .outbound-list-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .panel-header {
        padding: 16px 24px;
        border-bottom: 1px solid #f3f4f6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .panel-title {
        font-size: 16px;
        font-weight: 600;
    }

    .img-thumbnail-small {
        width: 60px;
        height: 60px;
        background: #f9fafb;
        border-radius: 4px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
        cursor: zoom-in;
    }

    .img-thumbnail-small img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .sku-code {
        font-weight: 600;
        color: #1a1a1a;
    }

    .stock-qty {
        font-weight: 600;
        font-size: 15px;
        text-align: center;
    }

    .stock-normal {
        color: #059669;
    }

    .stock-low {
        color: #f59e0b;
    }

    .stock-out {
        color: #ef4444;
    }

    .qty-input-group {
        display: flex;
        align-items: center;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        width: 100px;
    }

    .btn-qty-minus, .btn-qty-plus {
        width: 30px;
        height: 30px;
        background: #f9fafb;
        border: none;
        cursor: pointer;
        font-weight: bold;
        color: #6b7280;
    }

    .btn-qty-minus:hover, .btn-qty-plus:hover {
        background: #e5e7eb;
        color: #1a1a1a;
    }

    .form-control-qty {
        width: 40px;
        text-align: center;
        border: none;
        border-left: 1px solid #d1d5db;
        border-right: 1px solid #d1d5db;
        height: 30px;
        font-weight: 600;
        outline: none;
    }

    .btn-icon-action {
        background: white;
        border: 1px solid #d1d5db;
        cursor: pointer;
        padding: 6px;
        color: #374151;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .btn-icon-action:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
        color: #1a1a1a;
    }

    .btn-icon-action svg {
        width: 18px;
        height: 18px;
        stroke-width: 2;
    }

    .row-warning {
        background-color: #fef3c7;
    }

    .warning-list {
        margin: 16px 0;
        padding-left: 24px;
    }

    .warning-list li {
        margin: 8px 0;
        color: #92400e;
        font-size: 13px;
    }

    .empty-state {
        padding: 48px;
        text-align: center;
        color: #9ca3af;
    }

    .empty-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }

    .lightbox-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        cursor: zoom-out;
    }

    .lightbox-overlay.active {
        display: flex;
        animation: fadeIn 0.2s;
    }

    .lightbox-content {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
    }

    .lightbox-content img {
        max-width: 100%;
        max-height: 90vh;
        border-radius: 4px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .lightbox-close {
        position: absolute;
        top: -40px;
        right: 0;
        background: none;
        border: none;
        color: white;
        font-size: 32px;
        cursor: pointer;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
